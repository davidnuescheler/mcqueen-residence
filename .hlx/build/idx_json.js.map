{"version":3,"sources":["idx_json.js"],"names":["htmlPre","require","pre","main","context","document","content","tables","basic","entries","images","titleEl","querySelector","title","textContent","descEl","description","imgUrls","querySelectorAll","forEach","img","push","src","response","body","module","exports","helix_wrap_action","OpenWhiskAction","pipe","before","after","replace","CONTEXT_PROPS","CONTENT_PROPS","REQUEST_PROPS","RESPONSE_PROPS","filterObject","obj","allowedProperties","Object","keys","key","indexOf","sanitizeContext","request","wrapped","params","once","action","invoker","next","ret","Promise","resolve","res","type","hast","String","runPipeline"],"mappings":"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","file":"idx_json.js","sourceRoot":"../pages/master/src","sourcesContent":["/*\n * Copyright 2018 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\n/* eslint-disable */\n\n/*\n * Copyright 2019 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\n/* eslint-disable import/no-unresolved */\nconst htmlPre = require('./html.pre').pre;\n/**\n * The 'pre' function that is executed before the HTML is rendered\n * @param context The current context of processing pipeline\n * @param context.content The content\n */\n\n\nasync function main(context) {\n  await htmlPre(context);\n  const {\n    document\n  } = context.content; // construct the tables\n\n  const tables = {};\n  const basic = {\n    entries: {}\n  };\n  const images = {\n    entries: {}\n  };\n  const titleEl = document.querySelector('h1');\n\n  if (titleEl) {\n    basic.entries.title = titleEl.textContent;\n  }\n\n  const descEl = document.querySelector('.title .header p');\n\n  if (descEl) {\n    basic.entries.description = descEl.textContent;\n  }\n\n  const imgUrls = [];\n  document.querySelectorAll('img').forEach(img => {\n    imgUrls.push(img.src);\n  });\n  images.entries = {\n    images: imgUrls\n  };\n  tables.basic = basic;\n  tables.images = images;\n  return {\n    response: {\n      body: tables\n    }\n  };\n}\n\nmodule.exports.main = main;\nfunction helix_wrap_action(main) {\n  const { OpenWhiskAction } = require('@adobe/helix-pipeline');\n  const { pipe } = require('./idx_json.pipe.js');\n  const { pre, before, after, replace } = require('@adobe/helix-pipeline/src/defaults/json.pre.js');\n\n  // todo: move to helix-pipeline\n  const CONTEXT_PROPS = ['error', 'request', 'content', 'response'];\n  const CONTENT_PROPS = ['sources', 'body', 'mdast', 'sections', 'document', 'htast' ,'json', 'xml', 'meta', 'title', 'intro', 'image'];\n  const REQUEST_PROPS =  ['url', 'path', 'pathInfo', 'rootPath', 'selector', 'extension', 'method', 'headers', 'params'];\n  const RESPONSE_PROPS = ['status', 'body', 'hast', 'headers', 'document'];\n\n  const filterObject = (obj, allowedProperties) => {\n    if (!obj) {\n      return;\n    }\n    Object.keys(obj).forEach((key) => {\n      if (allowedProperties.indexOf(key) < 0) {\n        delete obj[key];\n      }\n    })\n  };\n\n  const sanitizeContext = (context) => {\n    filterObject(context, CONTEXT_PROPS);\n    filterObject(context.content, CONTENT_PROPS);\n    filterObject(context.request, REQUEST_PROPS);\n    filterObject(context.response, RESPONSE_PROPS);\n  };\n\n  // this gets called by openwhisk\n  return async function wrapped(params) {\n    // this is the once function that will be installed in the pipeline\n    async function once(context, action) {\n      // calls the pre function and then the script's main.\n      async function invoker(next) {\n        const ret = await Promise.resolve(pre(context, action));\n        const res = await Promise.resolve(next(ret || context, action));\n        if (!context.response) {\n          context.response = {};\n        }\n        if (typeof res === 'object') {\n          // check for response from direct script\n          if (res.response) {\n            context.response = res.response;\n          } else if (res.type) {\n            context.response.hast = res;\n          } else {\n            context.response.document = res;\n          }\n        } else {\n          context.response.body = String(res);\n        }\n        sanitizeContext(context);\n        return context;\n      }\n      return invoker(main);\n    }\n\n    if (before) {\n      once.before = before;\n    }\n    if (after) {\n      once.after = after;\n    }\n    if (replace) {\n      once.replace = replace;\n    }\n    return OpenWhiskAction.runPipeline(once, pipe, params);\n  };\n}\n\nmodule.exports.main = helix_wrap_action(module.exports.main);\n"]}