{"version":3,"sources":["idx_json.pipe.js"],"names":["Pipeline","require","log","fetch","parse","meta","html","type","selectStatus","smartypants","sections","selectstrain","selecttest","debug","key","production","dump","validate","cache","uncached","embeds","parseFrontmatter","unwrapSoleImages","timing","sanitize","resolveRef","hascontent","content","undefined","body","paranoid","context","action","secrets","SANITIZE_DOM","jsonpipe","cont","logger","pipe","timer","every","record","when","update","use","expose","report","error","run","module","exports"],"mappings":"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","file":"idx_json.pipe.js","sourceRoot":"../pages/master/src","sourcesContent":["/*\n * Copyright 2019 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\n/* eslint newline-per-chained-call: off */\n/* eslint import/no-unresolved: off */\nconst { Pipeline } = require('@adobe/helix-pipeline/index');\nconst { log } = require('@adobe/helix-pipeline/src/defaults/default');\n\nconst fetch = require('@adobe/helix-pipeline/src/html/fetch-markdown');\nconst parse = require('@adobe/helix-pipeline/src/html/parse-markdown');\nconst meta = require('@adobe/helix-pipeline/src/html/get-metadata');\nconst html = require('@adobe/helix-pipeline/src/html/make-html');\nconst type = require('@adobe/helix-pipeline/src/utils/set-content-type');\nconst selectStatus = require('@adobe/helix-pipeline/src/html/set-status');\nconst smartypants = require('@adobe/helix-pipeline/src/html/smartypants');\nconst sections = require('@adobe/helix-pipeline/src/html/split-sections');\nconst { selectstrain, selecttest } = require('@adobe/helix-pipeline/src/utils/conditional-sections');\nconst debug = require('@adobe/helix-pipeline/src/html/output-debug');\nconst key = require('@adobe/helix-pipeline/src/html/set-surrogate-key');\nconst production = require('@adobe/helix-pipeline/src/utils/is-production');\nconst dump = require('@adobe/helix-pipeline/src/utils/dump-context');\nconst validate = require('@adobe/helix-pipeline/src/utils/validate');\nconst { cache, uncached } = require('@adobe/helix-pipeline/src/html/shared-cache');\nconst embeds = require('@adobe/helix-pipeline/src/html/find-embeds');\nconst parseFrontmatter = require('@adobe/helix-pipeline/src/html/parse-frontmatter');\nconst unwrapSoleImages = require('@adobe/helix-pipeline/src/html/unwrap-sole-images');\nconst timing = require('@adobe/helix-pipeline/src/utils/timing');\nconst sanitize = require('@adobe/helix-pipeline/src/html/sanitize');\nconst resolveRef = require('@adobe/helix-pipeline/src/utils/resolve-ref');\n\nfunction hascontent({ content }) {\n  return !(content !== undefined && content.body !== undefined);\n}\n\nfunction paranoid(context, action) {\n  return action && action.secrets && !!action.secrets.SANITIZE_DOM;\n}\n\nconst jsonpipe = (cont, context, action) => {\n  action.logger = action.logger || log;\n  action.logger.log('debug', 'Constructing custom JSON Pipeline');\n  const pipe = new Pipeline(action);\n  const timer = timing();\n  pipe\n    .every(dump.record)\n    .every(validate).when(() => !production())\n    .every(timer.update)\n    .use(resolveRef).expose('resolve').when(hascontent)\n    .use(fetch).expose('fetch').when(hascontent)\n    .use(parse).expose('parse')\n    .use(parseFrontmatter)\n    .use(embeds)\n    .use(smartypants)\n    .use(sections)\n    .use(meta).expose('meta')\n    .use(unwrapSoleImages)\n    .use(selectstrain)\n    .use(selecttest)\n    .use(html).expose('html')\n    .use(sanitize).when(paranoid)\n    .use(cont)\n    .use(type('application/json'))\n    .use(cache).when(uncached)\n    .use(key)\n    .use(debug)\n    .use(timer.report)\n    .error(dump.report)\n    .error(selectStatus);\n\n  action.logger.log('debug', 'Running custom JSON pipeline');\n  return pipe.run(context);\n};\n\nmodule.exports.pipe = jsonpipe;\n"]}